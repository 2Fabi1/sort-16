<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sort16</title>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --panel-bg: #ffffff;
            --text-color: #333;
            --primary-color: #3b82f6;
            --hover-bg: #eef2f7;
        }

        [data-theme="dark"] {
            --bg-color: #1f2937;
            --panel-bg: #2d3748;
            --text-color: #f5f5f5;
            --primary-color: #60a5fa;
            --hover-bg: #374151;
        }

        body {
            display: flex;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--bg-color);
            color: var(--text-color);
            transition: background 0.3s, color 0.3s;
        }

        .records {
            width: 20vw;
            height: 80vh;
            margin-right: 20px;
            background: var(--panel-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            overflow-y: auto;
            transition: background 0.3s;
        }

        .records h2 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .records p {
            font-size: 1em;
            margin: 8px 0;
            padding: 6px 10px;
            border-radius: 6px;
            transition: background 0.2s, color 0.2s;
        }

        .records p:hover {
            background: var(--hover-bg);
            cursor: pointer;
        }

        .mainmenu {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            transition: background 0.3s;
        }

        .mainmenu h1, .mainmenu h3 {
            color: var(--text-color);
        }

        select {
            padding: 10px 14px;
            font-size: 1em;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
            outline: none;
            transition: border 0.2s, box-shadow 0.2s;
        }

        select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        button {
            padding: 10px 20px;
            font-size: 1em;
            margin: 5px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            background: var(--primary-color);
            color: white;
            transition: background 0.2s, transform 0.1s;
        }

        button:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        #main {
            font-size: 2em;
            font-family: 'Courier New', Courier, monospace;
            margin-top: 30px;
            word-break: break-word;
            color: var(--text-color);
        }

        .records::-webkit-scrollbar {
            width: 8px;
        }

        .records::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .records::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .records::-webkit-scrollbar-thumb:hover {
            background: #a0a0a0;
        }

        #darkModeToggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: var(--panel-bg);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            transition: background 0.3s, transform 0.2s;
        }

        [data-theme="light"] #darkModeToggle {
            background: #3e4753;
            color: #f5f5f5;
        }

        [data-theme="dark"] #darkModeToggle {
            background: #9da3ad;
            color: #1f2937;
        }

        #darkModeToggle:hover {
            transform: scale(1.1);
        }

        #themeIcon {
            pointer-events: none;
        }
    </style>
</head>
<body data-theme="light">

    <button id="darkModeToggle" aria-label="Toggle Dark Mode">
        <span id="themeIcon">ðŸŒ™</span>
    </button>

    <div class="records">
        <h2>Records (s):</h2>
        <div id="record-list"></div>
    </div>

    <div class="mainmenu">
        <h1>Sort16</h1>
        <h3 class="label1">Select character number (8-36): </h3>
        <select id="choice"></select>
        <button onclick="startGame()" id="play">Play</button>
        <p id="main"></p>
        <button onclick="startGame()" id="restart" style="display:none">Restart</button>
        <button onclick="mainMenu()" id="menu" style="display:none">Main menu</button>
        <p>Sponsored by Mr. Breast</p>
    </div>

    <script>
        const toggle = document.getElementById('darkModeToggle');
        const themeIcon = document.getElementById('themeIcon');

        // Set icon depending on theme
        function updateIcon(theme) {
            themeIcon.textContent = theme === 'dark' ? 'ðŸŒž' : 'ðŸŒ™';
        }

        toggle.addEventListener('click', () => {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateIcon(newTheme);
        });

        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);
        updateIcon(savedTheme);

        let timerInterval;
        let startTime;

        const template = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        let stringWithBrackets = "";
        let bracketPos = 0;
        let bracketSize = 0;
        let mainString = "";

        let records = Array(29).fill(null);

        const recordList = document.getElementById('record-list');
        const dropdown = document.getElementById('choice');
        const button = gebi("play");
        const restart = gebi("restart");
        const mainmenu = gebi("menu");

        for(let i = 8; i <= 36; i++) {
            const p = document.createElement('p');
            p.id = i;
            p.textContent = `${i}: --:--.---`;
            recordList.appendChild(p);
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            dropdown.appendChild(option);
        }

        function gebi(id) { return document.getElementById(id); }

        function keyHandler(event) {
            let keyPressed = event.key;
            let stringLen = mainString.length;
            let shifting = mainString.slice(bracketPos, bracketPos + bracketSize);
            let label2 = gebi("main");
            if (keyPressed == "a" && bracketPos > 0) {
                bracketPos--;
            } else if (keyPressed == "d" && bracketPos + bracketSize < stringLen) {
                bracketPos++;
            } else if (keyPressed == "ArrowLeft" && shifting) {
                mainString = mainString.slice(0, bracketPos) + shiftByOne(shifting, "left") + mainString.slice(bracketPos + bracketSize);
            } else if (keyPressed == "ArrowRight" && shifting) {
                mainString = mainString.slice(0, bracketPos) + shiftByOne(shifting, "right") + mainString.slice(bracketPos + bracketSize, mainString.length);
            } else return;

            label2.textContent = bracket_first_x(mainString, bracketPos, bracketPos + bracketSize);
            if (mainString === template.slice(0, stringLen)) {
                winGame();
            }
        }

        function startGame() {
            let choice = parseInt(gebi("choice").value);
            let label1 = document.querySelector(".label1");
            let bracketPos = 0;
            if (choice < 8 || choice > 36) {  
                label1.textContent = "Select number from 8 to 36!";
                label1.style.color = "red";
                setTimeout(() => {
                    label1.textContent = "Select character number (8-36): ";
                    label1.style.color = "black";
                }, 1000);
                return;
            }

            startTime = Date.now();
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                let elapsed = Date.now() - startTime;
                label1.textContent = `Time: ${(elapsed / 1000).toFixed(3)} s`;
            }, 1);

            dropdown.style.display = "none";
            button.style.display = "none";
            restart.style.display = "inline";
            mainmenu.style.display = "inline";

            mainString = createString(choice); 
            bracketSize = Math.ceil(choice / 2);
            let label2 = gebi("main");
            label2.textContent = bracket_first_x(mainString, 0, bracketSize);
            
            document.addEventListener("keydown", keyHandler);
        }

        function mainMenu() {
            clearInterval(timerInterval);
            let label1 = document.querySelector(".label1");
            label1.textContent = "Select character number (8-36): ";

            dropdown.style.display = "inline";
            button.style.display = "inline";
            restart.style.display = "none";
            mainmenu.style.display = "none";
            let label2 = gebi("main");
            label2.textContent = "";

            document.removeEventListener("keydown", keyHandler);
        }

        function winGame() {
            clearInterval(timerInterval);
            let elapsed = Date.now() - startTime;
            let label1 = document.querySelector(".label1");
            label1.style.color = "green";

            let label2 = gebi("main");
            label2.textContent = "";

            let recordLabel = gebi(mainString.length.toString());
            if (records[mainString.length - 8] === null || elapsed < records[mainString.length - 8]) {
                records[mainString.length - 8] = elapsed;
                recordLabel.textContent = `${mainString.length}: ${(elapsed / 1000).toFixed(3)}s`;
            }

            label1.textContent = `You win! Time: ${(elapsed / 1000).toFixed(3)} s. Record: ${(records[mainString.length - 8] / 1000).toFixed(3)} s`;
            document.removeEventListener("keydown", keyHandler);
        }

        function createString(len) {
            let str = template.slice(0, len);
            let arr = str.split("");
            for (let i = arr.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr.join("");
        }

        function shiftByOne(text, direction) {
            if (!text) return text;
            if (direction === "left") return text.slice(1) + text[0];
            if (direction === "right") return text.slice(-1) + text.slice(0, -1);
        }

        function bracket_first_x(text, start, x) {
            let chars = text.split("");
            let spaced_chars = chars.join("  ");
            let spaced_list = spaced_chars.split("  ");
            
            // Ensure x doesn't exceed text length
            x = Math.min(x, text.length);
            
            let first_part = spaced_list.slice(0, start).join("  ") + " [ " + spaced_list.slice(start, x).join("  ") + " ]";
            let second_part = spaced_list.slice(x).join("  ");
            return first_part + (second_part ? "  " + second_part : "");
        }

    </script>
</body>
</html>


